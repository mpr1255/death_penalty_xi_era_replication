function LoginSucess(a){$.post(APPPATH+"/login/LoginIn",{uid:a.Uid},function(){if($("#briefBox").is(":visible")==true){BriefExtend.searchCallBackFun(false)}if($("div.top-menu-bar>ul.menus>li.active").length>0){$("div.top-menu-bar>ul.menus>li.active").click()}if($(".content-middle").length>0&&$("#focus").hasClass("active")){$(".sidebar-a-menus ul.menus li.active").click()}$("#Ecp_MycnkiLink").hide();getPersonSets();if(isPersonLogin()){$("#spanmycnki").addClass("haslogin");$("#Ecp_MycnkiLink").show()}if($("#isoversea").val()=="1"){if(isBKLogin()&&$("#subscribe").length==0){$("#spanmycnki").after('<a id="subscribe" class="ecp_tn-tab" href='+APPPATH+"/rss><i>"+message.subscribe+"</i></a>")}}})}function getPersonSets(b){if($(".doctype-menus").length<1){return}var d=GEetUInfoFromECP("utype");if(islogin()&&d=="jf"){var a=sessionCookieUnit.getCookie("personsets");if(a){return a}var c=$("#krs").val()+"/gethistory/gethistoryhandler.ashx?action=setup&username="+getUsername();if(b){$.ajaxSettings.async=false}$.getJSON(c+"&callback=?",function(f){if(f){var e=f;if(e&&e.success&&e.success.table&&e.success.table.length>0){a=e.success.table[0].Value;sessionCookieUnit.addToCookie("personsets",a)}}});$.ajaxSettings.async=true;return a}}function Ecp_LogoutOptr(b){var a=APPPATH+"/login/LoginOut?q=-1";$("#Ecp_header_Register").hide();$.post(a,null,function(){if($("#briefBox").is(":visible")==true){$.BriefExtend.searchCallBackFun(false)}if($("div.top-menu-bar>ul.menus>li.active").length>0){$("div.top-menu-bar>ul.menus>li.active").click()}if($(".content-middle").length>0){if($("#focus").hasClass("active")){dbhomePage.getFocus();dbhomePage.getCollectPublication()}}sessionCookieUnit.unset("personsets")});if($(".content-middle").length>0&&$("#focus").hasClass("active")){if(histroyuser){histroyuser.clear()}$(".sidebar-a-menus ul.menus li.active").click()}if($("#subscribe").length>0){$("#subscribe").remove()}}function LayInitComplete(){ModifyEcpHeader(true)}function ModifyEcpHeader(a){var c=APPPATH+"/SearchHelper/SearchSettings";$("#Ecp_header_Help").after('<div class="ecp_tn-title" id="searchset" style="display: none;">   <a class="ecp_tn-tab" onclick="searchSet()" href="javascript:void(0)"><i>'+message.searchSet+"</i></a>  </div>");if($("#dbcode").val()!=undefined&&$("#isoversea").val()!="1"){dblist.changeSearchSetState($("#dbcode").val())}$("#Ecp_header_Help").before('<a id="oldversion" class="ecp_tn-tab" target="_blank" href="'+message.OldversionPath+'"><i>'+message.oldversion+"</i></a>");$("#Ecp_header_Help i").text(message.helpCenter);var b='<span class="ecp_tn-arrow"></span>';$("#Ecp_top_login1 i").text(message.loginjg).append(b);if($("#isoversea").val()=="1"){$("#Ecp_top_login i").text(message.login).append(b)}$("#Ecp_header_Register").hide();$("#Ecp_header_mycnki").remove();$("#Ecp_header_ChargeCenter").remove();$("#Ecp_header_BuyCard").remove();$("#Ecp_header_Mobile").remove();$("#Ecp_header_english").remove();$(".tn-person-r .ecp_tn-title .ecp_tn-tab:contains('我的CNKI')").remove();if($("#isoversea").val()!="1"){if($("#isperdbHomepage").val()=="1"){var c=$("#OverSeaURL").val()+"?dbcode="+GetQueryStringByName("dbcode");$("#oldversion").before('<a id="english" class="ecp_tn-tab" target="_blank" href="'+c+'"><i>ENGLISH</i></a>');$("#english").before('<a id="phoneversion" class="ecp_tn-tab" target="_blank" href="//m.cnki.net/mcnkidown/index.html"><i>手机版</i></a>');$("#oldversion").remove()}$("#Ecp_header_Help").text("使用手册").attr("href","//piccache.cnki.net/index/helper/manual.html");$("#searchset").after('<a id="member-link" name="member-link" class="ecp_tn-tab" target="_blank" href="https://mall-cnki-net.virtual.anu.edu.au/user/user.html"><i>会员</i></a><a id="icnki" class="ecp_tn-tab" target="_blank" href="https://i-cnki-net.virtual.anu.edu.au"><i>我的CNKI</i></a>')}else{$("#searchset").after(mycnkihtml());if(isBKLogin()&&$("#subscribe").length==0){$("#spanmycnki").after('<a id="subscribe" class="ecp_tn-tab" href='+APPPATH+"/rss><i>"+message.subscribe+"</i></a>")}}}$(function(){var a=$(".notice-box");$(".new-entrance").click(function(b){b.preventDefault();a.popCenter({isReomvePop:false,closeBtns:[".btn-close"]})})});function mycnkihtml(){var a="<span class='mycnki topItem' id='spanmycnki'>";a+="<a id='link_mycnki' class='ecp_tn-tab'  href='javascript:void(0);' onclick='setmycnkiclass()'>"+message.shufang+"<i class='ecp_tn-arrow'></i></a>";a+="<div id='pop_mycnki' class='topItemPop mycnkipop' style='display:none;'>";a+="<a class='close' href='javascript:void(0)' onclick='$(this).parent().hide()'>x</a>";a+="<div class='klogin_fr'>";a+="<ul class='mlist'>";a+="<li><a href='javascript:void(0)' onclick='openKpc()'>"+message.enter+" <b>"+message.shufang+"</b> &gt;&gt;</a></li>";a+="<li><a href='javascript:void(0)' onclick=openKpc('fav_paper')  target='_parent'>"+message.mycollect+"</a></li>";a+="<li><a href='javascript:void(0)' onclick=openKpc('history_search')  target='_parent'>"+message.myhistory+"</a></li>";a+="<li><a href='javascript:void(0)' onclick=openKpc('custom') target='_parent'>"+message.mysubscribe+"</a></li>";a+="<li><a href='javascript:void(0)' onclick=openKpc('citationTracking') target='_parent'>"+message.citationTrack+"</a></li>";a+="<li><a href='javascript:void(0)' onclick=openKpc('myAchievement') target='_parent'>"+message.myarchive+"</a></li>";a+="</ul></div>";a+="<div class='klogin_fl'>";a+="<ul class='mlist'>";a+="<li class='prompt'><span>"+message.pleaseinfo+"</span></li>";a+="</ul></div></div></span>";return a}function openKpc(a){var b=getUInfoFromECP("utype");if(!b||b!="jf"){OpenLoginPage();return false}var d="";if(!!a){d="#"+a}var e=$("#KPCPATH").val();var c=e+"?t="+Math.random()+d;window.open(c,"kns_gerenshufang")}function setmycnkiclass(){$("#spanmycnki").toggleClass("topItemCur");$("#pop_mycnki").toggle();if(isPersonLogin()){$(".klogin_fl").hide()}else{$(".klogin_fl").show()}}function OpenLoginPage(){var e=getUInfoFromECP("uname");var b=getUInfoFromECP("utype");var c=getValueFromCookie("LID");if(parent.$("#Ecp_top_login_layer").css("display")=="none"){parent.$("#Ecp_top_login").click()}var a="";if(!e||!b||!c){a=message.shufangLoginInfo}else{if(b!="jf"){a=message.shufangjginfo}else{parent.$("#Ecp_top_login_layer").css("display","none");return}}var d="<li id='alertinfo' style='width: 230px!important;margin-left: -12px!important;padding: 10px 20px!important; line-height: 20px!important; border: 1px solid #fbba05;background-color:#fffae8;color: #DA0000; '>"+a+"</li>";parent.$("#alertinfo").remove();parent.$(".loginformlist").append(d)}function searchSet(){setupPop=$("#searchsetdiv").show();if($.isFunction(SetSearchState)){SetSearchState()}layer.open({type:1,title:message.searchSet,shadeClose:true,shade:0.5,area:"800px",content:setupPop,})}function GEetUInfoFromECP(o){var ecpjosn,ecpjosntype;if(!o){return""}ecpjosn=getValueFromCookie("Ecp_LoginStuts");if(!!ecpjosn){ecpjosn=decodeURIComponent(ecpjosn);ecpjosntype=eval("("+ecpjosn+")");switch(o){case"uname":return ecpjosntype.UserName;case"utype":return ecpjosntype.UserType;case"sname":return decodeURI(decodeURIComponent(ecpjosntype.ShowName));case"BUserType":return ecpjosntype.BUserType;default:return""}}return""}function islogin(){var c=getValueFromCookie("Ecp_LoginStuts");var a;if(!!c){var b=JSON.parse(c);a=b.UserName}if(!!a){return true}return false}function isPersonLogin(){var a=GEetUInfoFromECP("utype");return islogin()&&a.toLowerCase()=="jf"}function isBKLogin(){var a=GEetUInfoFromECP("utype");var b=GEetUInfoFromECP("BUserType");return islogin()&&a.toLowerCase()=="bk"};